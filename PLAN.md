# PLAN.md
## Поэтапный план реализации приложения GoNext — Дневник туриста

---

## Этап 0. Подготовка окружения

1. Установить и проверить зависимости:
   - `expo-sqlite` — локальная БД
   - `react-native-paper` — UI-компоненты
   - `expo-location` — геолокация
   - `expo-image-picker` — выбор фотографий
   - `expo-file-system` — хранение фото
   - `expo-linking` — открытие карт и навигаторов

2. Настроить навигацию (Expo Router) и базовую структуру папок `app/`.

3. Подключить React Native Paper (ThemeProvider, провайдеры).

---

## Этап 1. База данных (SQLite)

1. Создать схему БД:
   - Таблица `places` (id, name, description, visitlater, liked, lat, lng, createdAt)
   - Таблица `photos` (id, placeId, filePath, createdAt) — фото мест
   - Таблица `trips` (id, title, description, startDate, endDate, current, createdAt)
   - Таблица `trip_places` (id, tripId, placeId, `order`, visited, visitDate, notes, createdAt)
   - Таблица `trip_place_photos` (id, tripPlaceId, filePath, createdAt)

2. Реализовать инициализацию БД при первом запуске.

3. Создать сервис/репозиторий для работы с данными (CRUD по сущностям).

---

## Этап 2. Режим «Места»

1. Экран списка мест:
   - Загрузка мест из БД
   - Отображение в виде списка (React Native Paper List)
   - Кнопка «Добавить место»

2. Экран создания/редактирования места:
   - Поля: name, description, visitlater, liked, координаты (lat, lng)
   - Получение координат через геолокацию или ручной ввод
   - Сохранение в БД

3. Экран детальной карточки места:
   - Просмотр всех полей
   - Список прикреплённых фото
   - Кнопка «Открыть на карте» (через `Linking` → geo-URL)
   - Кнопка «Добавить фото» (expo-image-picker + сохранение в file-system)
   - Редактирование и удаление

4. Интеграция экранов с навигацией (переходы, передача параметров).

---

## Этап 3. Режим «Поездки»

1. Экран списка поездок:
   - Загрузка поездок из БД
   - Отображение названия, дат, признака current
   - Кнопка «Создать поездку»

2. Экран создания/редактирования поездки:
   - Поля: title, description, startDate, endDate, current
   - Добавление мест из базы мест (выбор из списка)
   - Drag-and-drop или стрелки для изменения порядка мест
   - Сохранение в `trips` и `trip_places`

3. Экран деталей поездки (маршрут):
   - Упорядоченный список мест с `order`, visited, visitDate, notes
   - Отметка места как посещённого
   - Добавление заметок и фото к посещённому месту
   - Переход к карточке места
   - Кнопка «Открыть на карте» для каждого места

4. Логика «план → дневник»: отображение состояния (план/дневник) в зависимости от дат и visited.

---

## Этап 4. Режим «Следующее место»

1. Экран «Следующее место»:
   - Выбор активной поездки (где `current = true`)
   - Поиск первого места с `visited = false` в `trip_places` по `order`
   - Отображение информации о следующем месте

2. Действия:
   - Кнопка «Открыть на карте» (geo-URL)
   - Кнопка «Открыть в навигаторе» (maps/directions URL для Google Maps или системного навигатора)

3. Обработка случаев: нет активной поездки, все места посещены — показ информативного сообщения.

---

## Этап 5. Главный экран и навигация

1. Главный экран:
   - Заголовок «GoNext»
   - Кнопки: Места, Поездки, Следующее место, Настройки
   - Единый стиль (React Native Paper Button, Card и т.п.)

2. Настройка стеков/табов в Expo Router:
   - `app/index.tsx` — главный экран
   - `app/places/index.tsx`, `app/places/[id].tsx`, `app/places/new.tsx`
   - `app/trips/index.tsx`, `app/trips/[id].tsx`, `app/trips/new.tsx`
   - `app/next-place.tsx`
   - `app/settings.tsx`

3. Экраны настроек:
   - Базовый экран (на будущее: тема, единицы измерения и т.д.)

---

## Этап 6. Фото и файловая система

1. Хранение фото:
   - Папка `documents/places/` и `documents/trip_places/`
   - Сохранение путей в БД
   - Загрузка через `expo-image-picker`, копирование в `expo-file-system`

2. Отображение миниатюр и полноразмерных фото в карточках мест и поездок.

3. Удаление файлов при удалении записи (место/поездка).

---

## Этап 7. Геолокация и карты

1. Запрос разрешений на геолокацию (при необходимости).

2. Получение текущих координат для автоматического заполнения при создании места.

3. Формирование URL для открытия:
   - Карта: `geo:lat,lng` или `https://maps.google.com/?q=lat,lng`
   - Навигация: `google.navigation:q=lat,lng` (Android) / Apple Maps (iOS)

---

## Этап 8. Тестирование и доработка

1. Проверка офлайн-режима: приложение работает без интернета.

2. Проверка на Android и iOS (через Expo).

3. Исправление багов, улучшение UX.

4. Подготовка к релизу MVP.

---

## Порядок выполнения (кратко)

| # | Этап                    | Зависимости          |
|---|-------------------------|----------------------|
| 0 | Окружение и зависимости | —                    |
| 1 | База данных SQLite      | Этап 0               |
| 2 | Режим «Места»          | Этап 1               |
| 3 | Режим «Поездки»        | Этап 1, 2            |
| 4 | Режим «Следующее место»| Этап 1, 3            |
| 5 | Главный экран и навигация | Этапы 2, 3, 4    |
| 6 | Фото и файловая система| Этап 2, 3            |
| 7 | Геолокация и карты     | Этап 2, 4            |
| 8 | Тестирование           | Все этапы            |
